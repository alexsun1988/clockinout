<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>CTIS Clock in & out machine</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <style>
      body {
        padding-top: 54px;
      }
      @media (min-width: 992px) {
        body {
          padding-top: 56px;
        }
      }
      #pin{
          height: 48px;
      }
    </style>

  </head>

  <body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <div class="container">
        <a class="navbar-brand" href="#">In & Out</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Employees
                <span class="sr-only">(current)</span>
              </a>
            </li>
            <li class="nav-item active">
              <a class="nav-link" href="keypad.html">Keypad</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="management.html">Employee Management</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Page Content -->
    <div class="container">

      <div class="row mt-3">
        <div class="col-lg-4 mb-1 offset-lg-4 text-center">
            <h1><div id="pin"></div></h1><hr>
            <button class="btn btn-primary keypad-number" id="1">
                <h1>1</h1>
            </button>
            <button class="btn btn-primary keypad-number" id="2">
                <h1>2</h1>
            </button>
            <button class="btn btn-primary keypad-number" id="3">
                <h1>3</h1>
            </button>
        </div>
        <div class="col-lg-4 mb-1 offset-lg-4 text-center">
            <button class="btn btn-primary keypad-number" id="4">
                <h1>4</h1>
            </button>
            <button class="btn btn-primary keypad-number" id="5">
                <h1>5</h1>
            </button>
            <button class="btn btn-primary keypad-number" id="6">
                <h1>6</h1>
            </button>
        </div>
        <div class="col-lg-4 mb-1 offset-lg-4 text-center">
            <button class="btn btn-primary keypad-number" id="7">
                <h1>7</h1>
            </button>
            <button class="btn btn-primary keypad-number" id="8">
                <h1>8</h1>
            </button>
            <button class="btn btn-primary keypad-number" id="9">
                <h1>9</h1>
            </button>
        </div>
        <div class="col-lg-4 mb-1 offset-lg-4 text-center">
            <button class="btn btn-warning keypad-delete">
                <h5>DEL</h5>
            </button>
            <button class="btn btn-default keypad-enter" disabled>
                <h5>ENTER</h5>
            </button>
        </div>
      </div>

    </div>

    <!-- Modal -->
    <div class="modal fade" id="infoModal" tabindex="-1" role="dialog" aria-labelledby="infoModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body text-center" id="message">
            
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary btn-block" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script>
        function enableEnterButton(){
            $('.keypad-enter').removeClass('btn-default');
            $('.keypad-enter').addClass('btn-success');
            $('.keypad-enter').removeAttr('disabled');
        }
        function disableEnterButton(){
            $('.keypad-enter').removeClass('btn-success');
            $('.keypad-enter').addClass('btn-default');
            $('.keypad-enter').attr('disabled', 'disabled');
        }
        function resetCurrVal(){
            curr_val = '';
            $('#pin').html(curr_val);
        }
        function updateModalMessage(message){
            $('#message').html(message);
        }


        curr_val = '';
        $(document).ready(function(){
            $('.keypad-number').click(function(){
                if(curr_val.length < 4){
                    curr_val = curr_val + this.id;
                    $('#pin').html(curr_val);
                }
                if(curr_val.length == 4){
                    enableEnterButton();
                }
            });
            $('.keypad-delete').click(function(){
                if(curr_val.length >= 1){
                    curr_val = curr_val.substring(0, curr_val.length-1);
                    $('#pin').html(curr_val);
                }

                if(curr_val.length < 4){
                    disableEnterButton();
                }
            });
            $('.keypad-enter').click(function(){
                
                $.post('backend/public/api/clockinorout/'+curr_val, function(response){
                    $('#infoModal').modal('show'); 
                    if(response == 0){
                        updateModalMessage("You've successfully clocked out");
                        resetCurrVal();
                        disableEnterButton();
                    }else if(response == 1){
                        updateModalMessage("You've successfully clocked in");
                        resetCurrVal();
                        disableEnterButton();
                    }else{
                        updateModalMessage("Wrong PIN, try again!");
                        resetCurrVal();
                        disableEnterButton();
                    }
                });

            });
        });
    </script>

  </body>
</html>
